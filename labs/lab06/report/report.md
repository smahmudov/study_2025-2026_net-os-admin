---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Установка и настройка системы управления базами данных MariaDB"
author: "Суннатилло Махмудов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию системы управления базами данных на примере программного обеспечения MariaDB.

# Теоретические сведения  

**MariaDB** — система управления базами данных (СУБД), форк MySQL с открытым исходным кодом. Применяется для хранения, обработки и управления данными в приложениях и информационных системах.  

* **Сервер MariaDB** — основной компонент, выполняющий SQL-запросы и управляющий транзакциями.  
* **Клиентские утилиты** — программы для взаимодействия с сервером (`mysql`, `mariadb`).  
* **Хранилища данных (Storage Engines)** — модули для организации хранения (InnoDB, Aria, MyISAM и др.).  
* **Конфигурационные файлы** — задают параметры работы сервера (`my.cnf`).  

## Основные возможности MariaDB  

* Поддержка языка **SQL**;  
* **Многопользовательский доступ** и система прав;  
* **Репликация** для отказоустойчивости и масштабируемости;  
* Работа с большими объемами данных;  
* Совместимость с приложениями MySQL.  

## Этапы взаимодействия с MariaDB  

1. **Установка** серверного ПО.  
2. **Первичная настройка** параметров работы.  
3. **Создание баз данных** и учетных записей пользователей.  
4. **Конфигурирование безопасности**.  
5. **Тестирование и эксплуатация**.  


# Выполнение лабораторной работы

## Установка и первичная настройка MariaDB

1. На виртуальной машине **server** были установлены пакеты **mariadb** и **mariadb-server**.  

   ![Установка MariaDB](01.png){ #fig:001 width=80% }

2. В каталоге **/etc/my.cnf.d/** были просмотрены конфигурационные файлы MariaDB. Основные из них:  
   – `client.cnf` — параметры подключения клиента;  
   – `mariadb-server.cnf` — настройки сервера (порты, пути хранения данных, лимиты ресурсов);  
   – дополнительные конфиги (`auth_gssapi.cnf`, `enable_encryption.preset` и др.) — определяют модули и плагины.  

3. Для запуска и включения MariaDB в автозагрузку использовались системные команды.  

   ![Запуск и автозагрузка MariaDB](02.png){ #fig:002 width=80% }

4. Проверка показала, что служба **mariadbd** прослушивает порт **3306**, что подтверждает успешный запуск.  

5. Для повышения безопасности был запущен скрипт **mysql_secure_installation**:  
   – установлен пароль для пользователя **root** базы данных;  
   – отключён удалённый root-доступ;  
   – удалена тестовая база данных и анонимные пользователи.  

   ![Настройка безопасности MariaDB](03.png){ #fig:003 width=80% }

6. Был выполнен вход в систему управления БД под пользователем **root**.  

7. Отображён список доступных клиентских команд MariaDB.  

   ![Список команд MariaDB](04.png){ #fig:004 width=80% }

8. Для проверки системных баз данных по умолчанию был выполнен запрос **SHOW DATABASES**.  
   Результат: **information_schema**, **mysql**, **performance_schema**, **sys**.  

   ![Проверка системных БД](05.png){ #fig:005 width=80% }

## Конфигурация кодировки символов

1. До изменения параметров команда **status** показала текущую конфигурацию MariaDB, включая используемую кодировку.  

   ![Статус MariaDB до изменения](06.png){ #fig:006 width=80% }

2. В каталоге **/etc/my.cnf.d/** был создан файл **utf8.cnf** со следующими настройками:  

![Создание utf8.cnf](07.png){ #fig:007 width=80% }

3. После перезапуска MariaDB команда **status** показала изменения: клиент, сервер и базы данных теперь используют кодировку **utf8**.  

![Статус MariaDB после изменения кодировки](08.png){ #fig:008 width=80% }

## Создание базы данных и таблиц

1. В системе управления БД была создана база данных **addressbook** с кодировкой **utf8** и произведён переход к ней.  
   ![Создание базы addressbook](09.png){ #fig:009 width=80% }

2. В базе данных были просмотрены существующие таблицы (результат — пусто) и создана таблица **city** с полями *name* и *city*.  
3. Таблица была заполнена данными:  
   – Иванов, Москва;  
   – Петров, Сочи;  
   – Сидоров, Дубна.  

4. Запрос **SELECT \* FROM city** вывел все строки таблицы.  
   Результат: три записи с фамилиями и городами.  

## Управление пользователями и правами

1. Был создан пользователь **smahmudov** с паролем `123456`.  
2. Пользователю предоставлены права на просмотр, добавление, обновление и удаление данных в базе **addressbook**.  
3. Привилегии были обновлены.  
   ![Создание пользователя и выдача прав](10.png){ #fig:010 width=80% }

4. Команда **DESCRIBE city** показала структуру таблицы — два текстовых поля *name* и *city* длиной до 40 символов.  

## Проверка доступа к базе данных

1. Список баз данных был просмотрен под пользователем **root**, где присутствует **addressbook**.  
2. Были отображены таблицы базы **addressbook** под пользователями **root** и **smahmudov** — в обоих случаях доступна таблица **city**.  
   ![Проверка доступа к базе addressbook](11.png){ #fig:011 width=80% }

## Резервное копирование и восстановление

1. На виртуальной машине **server** был создан каталог для резервных копий: **/var/backup**.  
2. Выполнено резервное копирование базы **addressbook** в файл `addressbook.sql` и его сжатая версия `addressbook.sql.gz`.  
3. Также была создана копия с автоматическим добавлением даты в имя файла.  
   ![Создание резервных копий базы addressbook](12.png){ #fig:012 width=80% }

4. Выполнено восстановление базы данных из обычной и сжатой резервной копии.  

## Сохранение конфигурации и резервных копий

1. В каталоге **/vagrant/provision/server/** был создан подкаталог **mysql**, содержащий:  
   – конфигурацию MariaDB из `/etc/my.cnf.d/utf8.cnf`;  
   – резервные копии базы из каталога `/var/backup/`.  

2. Для автоматизации операций был подготовлен исполняемый файл **mysql.sh**.  
   ![Сохранение конфигурации и резервных копий](13.png){ #fig:013 width=80% }

# Вывод

В ходе лабораторной работы была установлена и настроена СУБД **MariaDB**.  
Были выполнены операции по установке и запуску сервиса, настройке параметров безопасности, проверке доступных системных баз данных. Создана база данных **addressbook**, в ней — таблица **city** с добавлением тестовых записей. Реализовано создание отдельного пользователя с выдачей ему прав доступа к базе. Проверены команды для отображения баз данных, таблиц и структуры таблиц. Настроена кодировка **utf8** на уровне сервера и клиента.  
Дополнительно выполнено резервное копирование базы данных с использованием утилиты **mysqldump**, восстановление базы из резервных копий, а также сохранение конфигурационных файлов в каталог для автоматизированного развертывания.  

# Контрольные вопросы

1. **Какая команда отвечает за настройки безопасности в MariaDB?**  
   Команда **mysql_secure_installation**.

2. **Как настроить MariaDB для доступа через сеть?**  
   В конфигурационном файле **/etc/my.cnf.d/mariadb-server.cnf** в секции `[mysqld]` необходимо изменить параметр **bind-address**, указав IP-адрес сервера или `0.0.0.0`. Также следует открыть порт **3306** в файерволе.

3. **Какая команда позволяет получить обзор доступных баз данных после входа в среду оболочки MariaDB?**  
   Команда **SHOW DATABASES;**.

4. **Какая команда позволяет узнать, какие таблицы доступны в базе данных?**  
   Команда **SHOW TABLES;**.

5. **Какая команда позволяет узнать, какие поля доступны в таблице?**  
   Команда **DESCRIBE имя_таблицы;** или сокращённо **DESC имя_таблицы;**.

6. **Какая команда позволяет узнать, какие записи доступны в таблице?**  
   Команда **SELECT * FROM имя_таблицы;**.

7. **Как удалить запись из таблицы?**  
   С помощью команды **DELETE FROM имя_таблицы WHERE условие;**.

8. **Где расположены файлы конфигурации MariaDB? Что можно настроить с их помощью?**  
   Основные конфигурационные файлы находятся в каталогах **/etc/my.cnf** и **/etc/my.cnf.d/**.  
   С их помощью можно настроить параметры сервера: пути хранения данных, сетевые параметры, кодировки, плагины, лимиты ресурсов, права доступа.

9. **Где располагаются файлы с базами данных MariaDB?**  
   По умолчанию базы данных хранятся в каталоге **/var/lib/mysql/**.

10. **Как сделать резервную копию базы данных и затем её восстановить?**  
    – Резервная копия: **mysqldump -u root -p имя_базы > файл.sql**  
    – Сжатая копия: **mysqldump -u root -p имя_базы | gzip > файл.sql.gz**  
    – Восстановление: **mysql -u root -p имя_базы < файл.sql**  
    – Восстановление из сжатой копии: **zcat файл.sql.gz | mysql -u root -p имя_базы**

	
# Список литературы

1. MariaDB Foundation. — URL: https://mariadb.org (дата обр. 13.09.2021).

2. Документация по MariaDB. — URL: https://mariadb.com/kb/ru/5306/.

3. Основы языка SQL. — URL: http://citforum.ru/programming/32less/les44.shtml (дата обр. 13.09.2021).