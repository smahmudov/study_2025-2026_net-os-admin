---
## Front matter
title: "Отчёт по лабораторной работе 4"
subtitle: "Базовая настройка HTTP-сервера Apache"
author: "Суннатилло Махмудов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и базовому конфигурированию HTTP-сервера Apache.

# Теоретические сведения

**Apache HTTP Server (или просто Apache)** — свободный веб-сервер, один из наиболее популярных и широко используемых в мире. Он позволяет предоставлять пользователям доступ к веб-страницам и приложениям по протоколу **HTTP** или его защищённой версии **HTTPS**. Благодаря модульной архитектуре Apache поддерживает гибкую настройку, расширение функционала и высокую производительность.  

* **HTTP-сервер** — программа, принимающая запросы от клиентов (обычно веб-браузеров) и возвращающая им запрашиваемые ресурсы: HTML-страницы, изображения, скрипты и др.  
* **Apache** — кроссплатформенный HTTP-сервер, работающий на различных операционных системах (Linux, Windows, macOS).  
* **Модульная структура** — возможность подключения дополнительных модулей для поддержки PHP, SSL/TLS, виртуальных хостов, аутентификации и других функций.  
* **Конфигурационные файлы** — основной способ настройки сервера. Главный файл: `httpd.conf`, а также дополнительные файлы включений (например, `sites-available`, `sites-enabled`).  

## Основные возможности Apache

* Обслуживание статических и динамических страниц;  
* Поддержка протоколов HTTP/1.1, HTTP/2 и HTTPS (через модуль `mod_ssl`);  
* Настройка **виртуальных хостов** (Virtual Hosts) для обслуживания нескольких сайтов на одном сервере;  
* Гибкая система логирования (доступ, ошибки, расширенные форматы логов);  
* Подключение и настройка модулей (`mod_php`, `mod_rewrite`, `mod_proxy` и др.);  
* Средства ограничения доступа и аутентификации пользователей.  

## Основные элементы конфигурации

* **DocumentRoot** — каталог, из которого сервер выдаёт файлы пользователям;  
* **ServerName** — имя или IP-адрес, по которому доступен веб-сайт;  
* **Directory** — секция для управления доступом и параметрами отдельных каталогов;  
* **Listen** — порт, на котором Apache принимает запросы (по умолчанию 80 для HTTP и 443 для HTTPS);  
* **ErrorLog** и **CustomLog** — файлы для записи ошибок и обращений к серверу.  

## Принцип работы HTTP-сервера Apache

1. **Client Request** — клиент (браузер) отправляет запрос к серверу по протоколу HTTP/HTTPS.  
2. **Server Processing** — Apache принимает запрос, проверяет настройки виртуальных хостов и определяет, какой ресурс нужно отдать.  
3. **Module Handling** — при необходимости запрос обрабатывается модулями (например, PHP-скрипт интерпретируется модулем `mod_php`).  
4. **Response** — сервер отправляет клиенту ответ (HTML-страницу, картинку, код ошибки и т. д.).  


# Выполнение лабораторной работы

## Установка HTTP-сервера

1. На виртуальной машине **server** был установлен пакет **httpd**, а также необходимые зависимости. После установки в каталоге `/etc/httpd/conf` появились основные конфигурационные файлы веб-сервера.  

   ![Установка httpd и зависимостей](Screenshot_1.png){ #fig:001 width=80% }

## Базовое конфигурирование HTTP-сервера

1. Для разрешения работы веб-сервера в межсетевом экране были добавлены правила для сервиса **http**.  

2. Служба **httpd** была включена в автозагрузку и запущена. Проверка статуса показала, что веб-сервер успешно работает и прослушивает порты 80 и 443.  

   ![Запуск и проверка статуса службы httpd](Screenshot_2.png){ #fig:002 width=80% }

3. При обращении к серверу с клиентской машины в браузере появилась стандартная тестовая страница Apache, подтверждающая корректность установки и запуска сервера.  

   ![Тестовая страница Apache](Screenshot_3.png){ #fig:003 width=80% }

## Анализ работы HTTP-сервера

1. На сервере был просмотрен лог ошибок, где отображаются сообщения о работе и возможных проблемах веб-сервера.  

2. Также был включён мониторинг журнала обращений. В нём фиксируются все запросы клиентов, включая обращение к главной странице по адресу 192.168.1.1.  

   ![Просмотр журналов работы Apache](Screenshot_4.png){ #fig:004 width=80% }

## Настройка виртуального хостинга для HTTP-сервера

1. В файлы описания DNS-зон были внесены изменения: в прямую зону добавлена запись `www`, а в обратную зону — запись `PTR` для соответствующего имени хоста.  

   ![Файл прямой DNS-зоны](Screenshot_5.png){ #fig:005 width=80% }  
   ![Файл обратной DNS-зоны](Screenshot_6.png){ #fig:006 width=80% }

2. В каталоге `/etc/httpd/conf.d` были созданы файлы конфигурации для виртуальных хостов **server.smahmudov.net** и **www.smahmudov.net**.  

   ![Конфигурация виртуального хоста server](Screenshot_7.png){ #fig:007 width=80% }  
   ![Конфигурация виртуального хоста www](Screenshot_8.png){ #fig:008 width=80% }

3. В каталоге `/var/www/html` были подготовлены директории с тестовыми страницами для каждого виртуального хоста.  

   ![Создание и редактирование файлов index.html](Screenshot_9.png){ #fig:009 width=80% }

4. Проверка в браузере показала успешную работу виртуальных хостов. При обращении к серверу по адресу **smahmudov.net** и **www.smahmudov.net** отображаются соответствующие тестовые страницы.  

   ![Тестовая страница server.smahmudov.net](Screenshot_10.png){ #fig:010 width=80% }  
   ![Тестовая страница www.smahmudov.net](Screenshot_11.png){ #fig:011 width=80% }

## Внесение изменений в настройки внутреннего окружения

1. Для корректной работы были установлены права доступа на каталог с веб-контентом и восстановлены контексты безопасности SELinux. После этого HTTP-сервер был перезапущен.  

   ![Корректировка прав доступа и перезапуск сервиса](Screenshot_12.png){ #fig:012 width=80% }

2. В каталоге `/vagrant/provision/server` был создан исполняемый файл **http.sh**, содержащий команды для автоматической установки и конфигурирования веб-сервера Apache.  

   ![Скрипт автоматической конфигурации http.sh](Screenshot_13.png){ #fig:013 width=80% }


# Вывод

В ходе работы был установлен и настроен HTTP-сервер Apache с поддержкой виртуального хостинга и проверкой его корректного функционирования через DNS-имена.

# Контрольные вопросы

1. **Через какой порт по умолчанию работает Apache?**  
   По умолчанию Apache работает через порт **80** для HTTP и порт **443** для HTTPS.  

2. **Под каким пользователем запускается Apache и к какой группе относится этот пользователь?**  
   В большинстве дистрибутивов Linux Apache запускается от пользователя **apache** или **www-data**, относящегося к одноимённой группе (**apache** или **www-data**).  

3. **Где располагаются лог-файлы веб-сервера? Что можно по ним отслеживать?**  
   Лог-файлы веб-сервера Apache находятся в каталоге **/var/log/httpd/** или **/var/log/apache2/**.  
   По ним можно отслеживать ошибки работы (**error_log**) и обращения клиентов (**access_log**), включая IP-адреса, запрашиваемые ресурсы и коды ответов.  

4. **Где по умолчанию содержится контент веб-серверов?**  
   Контент веб-сервера по умолчанию хранится в каталоге **/var/www/html**.  

5. **Каким образом реализуется виртуальный хостинг? Что он даёт?**  
   Виртуальный хостинг реализуется через отдельные конфигурационные файлы в каталоге **/etc/httpd/conf.d/** или директивы **<VirtualHost>** в настройках.  
   Он позволяет размещать несколько веб-сайтов на одном сервере, различая их по доменным именам или IP-адресам.  


# Список литературы

1. Apache HTTP Server Version 2.4 Documentation. — URL: http://httpd.apache.org/docs/current/ (дата обр. 13.09.2021).

2. Httpd — Apache Hypertext Transfer Protocol Server. — URL: https://httpd.apache.org/docs/2.4/programs/httpd.html (дата обр. 13.09.2021).
