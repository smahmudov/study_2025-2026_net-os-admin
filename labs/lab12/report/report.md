---
## Front matter
title: "Отчёт по лабораторной работе 12"
subtitle: "Синхронизация времени"
author: "Суннатилло Махмудов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Получение навыков по управлению системным временем и настройке синхронизации времени.

# Теоретические сведения

Синхронизация времени является важнейшей составляющей работы любой вычислительной системы, особенно в сетевой среде. Корректное и согласованное время на всех узлах обеспечивает точность журналов событий, корректность транзакций и безопасность протоколов аутентификации.

## Служба Chrony

**Chrony** — это современная реализация протокола NTP (Network Time Protocol), предназначенная для синхронизации системных часов с удалёнными серверами времени. В отличие от классического **ntpd**, служба **chronyd** быстрее адаптируется к изменениям в работе сети и поддерживает более точную синхронизацию в условиях нестабильного соединения, что особенно важно для виртуальных машин.

Chrony состоит из двух основных компонентов:
- **chronyd** — демон, выполняющий синхронизацию системных часов;
- **chronyc** — клиентская утилита командной строки для взаимодействия с демоном и просмотра состояния синхронизации.

## Принцип работы NTP

Протокол **NTP** (Network Time Protocol) обеспечивает точную синхронизацию системных часов с использованием многоуровневой иерархии серверов времени, называемых **стратами**.  
- **Stratum 0** — эталонные источники времени (например, атомные часы, GPS-приёмники);  
- **Stratum 1** — серверы, синхронизированные напрямую со stratum 0;  
- **Stratum 2** и ниже — системы, синхронизирующиеся с вышестоящими серверами.

Чем выше номер страты, тем больше потенциальная погрешность времени. Максимально допустимое значение страты — 16, при этом узел считается несинхронизированным.

## Конфигурация Chrony

Основной файл конфигурации расположен по пути **/etc/chrony.conf**.  
В нём можно определить:
- **server <имя_или_IP> iburst** — указание источников времени;  
- **allow <сеть>** — разрешение клиентам из указанной сети обращаться к серверу;  
- **local stratum <число>** — назначение локальной страты при отсутствии внешних источников;  
- **driftfile** — файл для хранения информации о дрейфе системных часов;  
- **rtcsync** — синхронизация аппаратных часов (RTC) с системными.

# Выполнение лабораторной работы

## Настройка параметров времени

1. На сервере и клиенте была просмотрена информация о текущем времени с помощью команды **timedatectl**.  
   Определено, что обе системы находятся в часовом поясе **UTC (UTC +0000)**, синхронизация времени активна (**NTP service: active**), а системные часы синхронизированы с сетевыми источниками.  

   ![Проверка параметров времени на сервере](01.png){ #fig:001 width=80% }  
   ![Проверка параметров времени на клиенте](02.png){ #fig:002 width=80% }

2. Текущее системное и аппаратное время было выведено с помощью команд **date** и **hwclock**.  
   В обоих случаях показано совпадение времени системных и аппаратных часов, что подтверждает корректную синхронизацию с NTP.

3. Для обеспечения сетевой синхронизации времени на сервере был установлен пакет **chrony**.  

4. После установки были проверены источники времени на сервере и клиенте командой **chronyc sources**.  
   Команда отобразила список NTP-серверов, с которых осуществляется синхронизация. Символы `^*` указывают на активный источник, `^-` и `^+` — на альтернативные.  

   ![Источники времени на сервере](03.png){ #fig:003 width=80% }  
   ![Источники времени на клиенте](04.png){ #fig:004 width=80% }

5. Для разрешения NTP-доступа с локальной сети в конфигурационный файл **/etc/chrony.conf** на сервере была добавлена строка:

   allow 192.168.0.0/16

   ![Редактирование chrony.conf на сервере](05.png){ #fig:005 width=80% }

6. После внесённых изменений служба **chronyd** была перезапущена, а в межсетевом экране открыт доступ к службе NTP.  

   ![Перезапуск chronyd и настройка брандмауэра](06.png){ #fig:006 width=80% }

7. На клиентской машине в файле **/etc/chrony.conf** была указана строка для синхронизации времени с сервером:

   server server.smahmudov.net iburst

   Остальные строки с директивами `server` были удалены.  

   ![Изменение chrony.conf на клиенте](07.png){ #fig:007 width=80% }

8. Служба **chronyd** на клиенте была перезапущена.  

9. После синхронизации на клиенте была повторно выполнена проверка источников времени.  
   Клиент синхронизируется с сервером **server.smahmudov.net**, что подтверждает корректную работу службы.  

   ![Проверка источников времени на клиенте после синхронизации](08.png){ #fig:008 width=80% }

10. Для автоматизации настройки NTP были созданы скрипты:  
    – на сервере:  

    ![Скрипт настройки NTP-сервера](09.png){ #fig:009 width=80% }

    – на клиенте:  

    ![Скрипт настройки NTP-клиента](10.png){ #fig:010 width=80% }


# Вывод

В ходе лабораторной работы была произведена настройка синхронизации времени с использованием службы **Chrony**.  
На сервере был установлен и сконфигурирован пакет **chrony**, разрешён доступ клиентам из локальной сети и открыт порт NTP в межсетевом экране.  
Клиентская система была настроена на синхронизацию времени с сервером **server.smahmudov.net**, после чего проверка показала успешное взаимодействие и совпадение системного и аппаратного времени.  

# Контрольные вопросы

1. **Почему важна точная синхронизация времени для служб баз данных?**  
   Точная синхронизация времени обеспечивает согласованность временных меток в транзакциях, логах и журналах. Несовпадение времени может привести к ошибкам при репликации, конфликтам данных и затруднению анализа событий в распределённых системах.

2. **Почему служба проверки подлинности Kerberos сильно зависит от правильной синхронизации времени?**  
   Kerberos использует временные метки для предотвращения повторных атак и проверки подлинности. Если разница во времени между клиентом и сервером превышает допустимый предел (обычно 5 минут), аутентификация будет отклонена.

3. **Какая служба используется по умолчанию для синхронизации времени на RHEL 7?**  
   В RHEL 7 по умолчанию используется служба **Chrony**, заменяющая устаревший **ntpd**.

4. **Какова страта по умолчанию для локальных часов?**  
   Для локальных часов (Local reference clock) по умолчанию задаётся **страта 10**.

5. **Какой порт брандмауэра должен быть открыт, если вы настраиваете свой сервер как одноранговый узел NTP?**  
   Необходимо открыть **UDP-порт 123**, используемый протоколом NTP для обмена пакетами синхронизации.

6. **Какую строку нужно включить в конфигурационный файл chrony, если вы хотите быть сервером времени, даже если внешние серверы NTP недоступны?**  
   В конфигурационный файл **/etc/chrony.conf** добавляется строка:  
   `local stratum 10`

7. **Какую страту имеет хост, если нет текущей синхронизации времени NTP?**  
   В этом случае хост получает **страта 10**, что означает отсутствие синхронизации с внешними источниками.

8. **Какую команду можно использовать на сервере с chrony, чтобы узнать, с какими серверами он синхронизируется?**  
   Для этого используется команда:  
   `chronyc sources`

9. **Как можно получить подробную статистику текущих настроек времени для процесса chrony на сервере?**  
   Подробную информацию о состоянии синхронизации можно получить командой:  
   `chronyc tracking`
	
# Список литературы

1. Настройка сервера и клиента chrony - https://redos.red-soft.ru/base/redos-8_0/8_0-administation/8_0-timedate/8_0-chrony-in-local-network/
